---
layout: post
title: "Vue Test Utils"
subtitle: JEST 单元测试笔记
date: 2020-08-20 20:10
author: "mipaifu328"
header-img: "img/in-post/2019-03/sea.jpeg"
tag: 
    - VUE
    - JEST
---

# 相关文档API

- [Vue Test Utils](https://vue-test-utils.vuejs.org/zh/)
- [JEST github](https://github.com/facebook/jest)
- [Jest 中文文档](http://facebook.github.io/jest/docs/zh-Hans/getting-started.html)

# 介绍

主流的 JavaScript 测试运行器有很多，但 Vue Test Utils 都能够支持。官方主要推荐其中的两个测试运行器，本文主要讨论的是`jest`。

> - jest 是功能最全的测试运行器。它所需的配置是最少的，默认安装了 JSDOM，内置断言且命令行的用户体验非常好。不过你需要一个能够将单文件组件导入到测试中的预处理器。我们已经创建了 vue-jest 预处理器来处理最常见的单文件组件特性，但仍不是 vue-loader 100% 的功能。
> - mocha-webpack 是一个 webpack + Mocha 的包裹器，同时包含了更顺畅的接口和侦听模式。这些设置的好处在于我们能够通过 webpack + vue-loader 得到完整的单文件组件支持，但这本身是需要很多配置的。

# JEST 基础

最简单的demo
1. npm 安装 jest `npm install --save-dev jest`
2. 创建sum.js、测试文件sum.test.js

``` js

  // sum.js
  function sum(a, b) {
    return a + b;
  }
  module.exports = sum;

  // sum.test.js
  const sum = require('./sum');

  test('adds 1 + 2 to equal 3', () => {
    expect(sum(1, 2)).toBe(3);
  });

```

3. 配置你的`package.json`：

``` js
{
  "scripts": {
    "test": "jest"
  }
}
```
4. 测试文件匹配（jest运行哪些测试文件）

配置项`testRegex`[string | array<string>]，默认值是`(/__tests__/.*|(\\.|/)(test|spec))\\.[jt]sx?$`
> 默认情况下，Jest 将会递归的找到整个工程里所有 .spec.js 或 .test.js 扩展名的文件。如果这不符合你的需求，你也可以在 package.json 里的配置段落中改变它的 testRegex。

>Jest 推荐你在被测试代码的所在目录下创建一个 __tests__ 目录，但你也可以为你的测试文件随意设计自己习惯的文件结构。不过要当心 Jest 会为快照测试在临近测试文件的地方创建一个 __snapshots__ 目录。
5. 运行 `npm run test`

``` js
PASS  ./sum.test.js
✓ adds 1 + 2 to equal 3 (5ms)
```

# vue 项目中应用 JEST